<?xml version="1.0" encoding="utf-8"?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             xmlns:dx="http://schemas.devexpress.com/maui"
             xmlns:viewmodels="clr-namespace:Kuyenda.ViewModels"
             xmlns:models="clr-namespace:Kuyenda.Models"
             x:DataType="viewmodels:MainViewModel"
             x:Class="Kuyenda.Views.MainPage">
    <ScrollView>
        <VerticalStackLayout Padding="15,0"
                             Spacing="25">
            <Border Padding="15"
                    BackgroundColor="{dx:ThemeColor SurfaceContainer}">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="15" />
                </Border.StrokeShape>
                <VerticalStackLayout Spacing="15">
                    <Label FontSize="Title"
                           Margin="0,0,0,15">
                        <Label.FormattedText>
                            <FormattedString>
                                <Span Text="Steps "
                                      FontAttributes="Bold" />
                                <Span Text="{Binding Source={x:Static sys:DateTime.Today}, StringFormat='{0:MMMM dd}'}" />
                            </FormattedString>
                        </Label.FormattedText>
                    </Label>
                    <Grid>
                        <dx:RadialProgressBar Thickness="20"
                                              ValueIndicatorThickness="20"
                                              MaximumWidthRequest="250"
                                              SweepAngle="360"
                                              StartAngle="-90"
                                              Value="{Binding ProgressPercentage}"
                                              StartValue="0"
                                              EndValue="100" />
                        <dx:DXStackLayout HorizontalOptions="Center"
                                          VerticalOptions="Center"
                                          Orientation="Vertical">
                            <dx:DXImage Source="feet.svg"
                                        Margin="0,0,0,10"
                                        TintColor="{dx:ThemeColor Primary}"
                                        HeightRequest="40" />
                            <Label Text="{Binding Steps}"
                                   FontSize="Title"
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center" />
                            <Label Text="Steps"
                                   FontSize="Body"
                                   HorizontalOptions="Center" />
                            <Label HorizontalOptions="Center"
                                   FontSize="Title">
                                <Label.FormattedText>
                                    <FormattedString>
                                        <Span Text="{Binding ProgressPercentage, StringFormat='{0:0.0}'}"
                                              FontAttributes="Bold" />
                                        <Span Text="%" />
                                    </FormattedString>
                                </Label.FormattedText>
                            </Label>
                        </dx:DXStackLayout>
                    </Grid>
                    <Grid ColumnDefinitions="*,*,*">
                        <VerticalStackLayout>
                            <Label Text="Goal"
                                   HorizontalOptions="Center"
                                   FontSize="Small"
                                   TextColor="{dx:ThemeColor OnSurfaceVariant}" />
                            <Label Text="{Binding StepGoal, StringFormat='{0:N0}'}"
                                   HorizontalOptions="Center"
                                   FontAttributes="Bold" />
                        </VerticalStackLayout>
                        <VerticalStackLayout Grid.Column="1">
                            <Label HorizontalOptions="Center"
                                   Text="Distance"
                                   FontSize="Small"
                                   TextColor="{dx:ThemeColor OnSurfaceVariant}" />
                            <Label HorizontalOptions="Center"
                                   Text="{Binding Steps, Converter={StaticResource StepsToDistanceConverter}, StringFormat='{0:0.0} km'}"
                                   FontAttributes="Bold" />
                        </VerticalStackLayout>
                        <VerticalStackLayout Grid.Column="2">
                            <Label Text="Calories"
                                   HorizontalOptions="Center"
                                   FontSize="Small"
                                   TextColor="{dx:ThemeColor OnSurfaceVariant}" />
                            <Label Text="{Binding Steps, Converter={StaticResource StepsToCaloriesConverter}, StringFormat='{0:0} kcal'}"
                                   HorizontalOptions="Center"
                                   FontAttributes="Bold" />
                        </VerticalStackLayout>
                    </Grid>
                </VerticalStackLayout>
            </Border>
            <dx:DXCollectionView ItemsSource="{Binding StepHistory}">
                <dx:DXCollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:StepModel">
                        <Grid Padding="10"
                              BackgroundColor="{dx:ThemeColor SurfaceContainer}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="2*" />
                                <ColumnDefinition Width="1*" />
                            </Grid.ColumnDefinitions>
                            <Label Text="{Binding Date, StringFormat='{0:MMMM dd}'}"
                                   FontSize="Body"
                                   Grid.Column="0" />
                            <Label Text="{Binding Steps, StringFormat='{0:N0}'}"
                                   FontSize="Body"
                                   Grid.Column="1" />
                            <Label Text="{Binding Steps, Converter={StaticResource StepsToDistanceConverter}, StringFormat='{0:0.0} km'}"
                                   FontSize="Body"
                                   Grid.Column="2" />
                        </Grid>
                    </DataTemplate>
                </dx:DXCollectionView.ItemTemplate>
            </dx:DXCollectionView>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>