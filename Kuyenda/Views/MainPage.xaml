<?xml version="1.0" encoding="utf-8"?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             xmlns:dx="http://schemas.devexpress.com/maui"
             xmlns:viewmodels="clr-namespace:Kuyenda.ViewModels"
             xmlns:models="clr-namespace:Kuyenda.Models"
             x:DataType="viewmodels:MainViewModel"
             x:Class="Kuyenda.Views.MainPage"
             BackgroundColor="{dx:ThemeColor Background}">
    <ScrollView>
        <VerticalStackLayout Padding="20"
                             Spacing="15">
            <!-- Header Card -->
            <Border Padding="20"
                    BackgroundColor="{dx:ThemeColor SurfaceContainer}">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="20" />
                </Border.StrokeShape>
                <VerticalStackLayout Spacing="20">
                    <Label FontSize="22"
                           FontAttributes="Bold"
                           TextColor="{dx:ThemeColor OnSurface}">
                        <Label.FormattedText>
                            <FormattedString>
                                <Span Text="Today's Steps - " />
                                <Span Text="{Binding Source={x:Static sys:DateTime.Today}, StringFormat='{0:dddd, MMMM dd}'}"
                                      FontAttributes="None" />
                            </FormattedString>
                        </Label.FormattedText>
                    </Label>
                    <!-- Radial Progress -->
                    <Grid>
                        <dx:RadialProgressBar Thickness="20"
                                              ValueIndicatorThickness="20"
                                              MaximumWidthRequest="240"
                                              SweepAngle="360"
                                              StartAngle="-90"
                                              Value="{Binding ProgressPercentage}"
                                              StartValue="0"
                                              EndValue="100" />
                        <dx:DXStackLayout Orientation="Vertical"
                                          HorizontalOptions="Center"
                                          VerticalOptions="Center"
                                          ItemSpacing="4">
                            <dx:DXImage Source="feet.svg"
                                        TintColor="{dx:ThemeColor Primary}"
                                        HeightRequest="40" />
                            <Label Text="{Binding Steps}"
                                   FontSize="26"
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center" />
                            <Label Text="steps"
                                   FontSize="14"
                                   TextColor="{dx:ThemeColor OnSurfaceVariant}"
                                   HorizontalOptions="Center" />
                            <Label FontSize="20"
                                   HorizontalOptions="Center">
                                <Label.FormattedText>
                                    <FormattedString>
                                        <Span Text="{Binding ProgressPercentage, StringFormat='{0:0}'}"
                                              FontAttributes="Bold" />
                                        <Span Text="%" />
                                    </FormattedString>
                                </Label.FormattedText>
                            </Label>
                        </dx:DXStackLayout>
                    </Grid>
                    <!-- Stats Grid -->
                    <Grid ColumnDefinitions="*,*,*"
                          Padding="10,0,10,0">
                        <!-- Goal -->
                        <VerticalStackLayout HorizontalOptions="Center">
                            <dx:DXImage Source="mission.png"
                                        HeightRequest="30" />
                            <Label Text="Goal"
                                   FontSize="12"
                                   HorizontalOptions="Center"
                                   TextColor="{dx:ThemeColor OnSurfaceVariant}" />
                            <Label Text="{Binding StepGoal, StringFormat='{0:N0}'}"
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center"
                                   FontSize="16" />
                        </VerticalStackLayout>
                        <!-- Distance -->
                        <VerticalStackLayout Grid.Column="1"
                                             HorizontalOptions="Center">
                            <dx:DXImage Source="distance.png"
                                        HeightRequest="30" />
                            <Label Text="Distance"
                                   FontSize="12"
                                   HorizontalOptions="Center"
                                   TextColor="{dx:ThemeColor OnSurfaceVariant}" />
                            <Label Text="{Binding Steps, Converter={StaticResource StepsToDistanceConverter}, StringFormat='{0:0.0} km'}"
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center"
                                   FontSize="16" />
                        </VerticalStackLayout>
                        <!-- Calories -->
                        <VerticalStackLayout Grid.Column="2"
                                             HorizontalOptions="Center">
                            <dx:DXImage Source="flames.png"
                                        HeightRequest="30" />
                            <Label Text="Calories"
                                   FontSize="12"
                                   HorizontalOptions="Center"
                                   TextColor="{dx:ThemeColor OnSurfaceVariant}" />
                            <Label Text="{Binding Steps, Converter={StaticResource StepsToCaloriesConverter}, StringFormat='{0:0.0} kcal'}"
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center"
                                   FontSize="16" />
                        </VerticalStackLayout>
                    </Grid>
                </VerticalStackLayout>
            </Border>
            <Grid Margin="0,10">
                <Label Text="Past Five Days"
                       FontSize="20"
                       VerticalOptions="Center"
                       Padding="0" />
                <dx:DXButton Icon="right_chevron.svg"
                             IconPlacement="Right"
                             Padding="0"
                             UseRippleEffect="False"
                             HorizontalOptions="End"
                             VerticalOptions="Center"
                             FontSize="18"
                             Content="View All"
                             ButtonType="Text" />
            </Grid>
            <dx:DXCollectionView ItemsSource="{Binding StepHistory}"
                                 ItemSpacing="5"
                                 ReduceSizeToContent="True">
                <dx:DXCollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:StepModel">
                        <Border Padding="20"
                                Margin="0,5"
                                BackgroundColor="{dx:ThemeColor SurfaceContainer}">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="5" />
                            </Border.StrokeShape>
                            <dx:DXStackLayout Orientation="Vertical">
                                <HorizontalStackLayout Margin="0,0,0,25"
                                                       Spacing="10">
                                    <Label Text="{Binding Date, Converter={StaticResource DateStringToHumanReadableConverter}}"
                                           FontAttributes="Bold"
                                           FontSize="18"
                                           TextColor="{dx:ThemeColor OnSurface}" />
                                </HorizontalStackLayout>
                                <Grid ColumnDefinitions="*,*,*"
                                      ColumnSpacing="10"
                                      VerticalOptions="Center">
                                    <HorizontalStackLayout Spacing="5"
                                                           HorizontalOptions="Start"
                                                           VerticalOptions="Center">
                                        <dx:DXImage Source="feet.svg"
                                                    HeightRequest="20"
                                                    WidthRequest="20"
                                                    TintColor="{dx:ThemeColor Primary}" />
                                        <Label Text="{Binding Steps, StringFormat='{0:N0}'}"
                                               FontSize="16"
                                               FontAttributes="Bold"
                                               TextColor="{dx:ThemeColor Primary}" />
                                    </HorizontalStackLayout>
                                    <HorizontalStackLayout Spacing="5"
                                                           Grid.Column="1"
                                                           HorizontalOptions="Center"
                                                           VerticalOptions="Center">
                                        <dx:DXImage Source="distance.png"
                                                    HeightRequest="20"
                                                    WidthRequest="20" />
                                        <Label Text="{Binding Steps, Converter={StaticResource StepsToDistanceConverter}, StringFormat='{0:0.0} km'}"
                                               FontSize="16"
                                               TextColor="{dx:ThemeColor OnSurfaceVariant}" />
                                    </HorizontalStackLayout>
                                    <HorizontalStackLayout Spacing="5"
                                                           Grid.Column="2"
                                                           HorizontalOptions="End"
                                                           VerticalOptions="Center">
                                        <dx:DXImage Source="flames.png"
                                                    HeightRequest="20"
                                                    WidthRequest="20" />
                                        <Label Text="{Binding Steps, Converter={StaticResource StepsToCaloriesConverter}, StringFormat='{0:0.0} kcal'}"
                                               FontSize="16"
                                               TextColor="{dx:ThemeColor OnSurfaceVariant}" />
                                    </HorizontalStackLayout>
                                </Grid>
                            </dx:DXStackLayout>
                        </Border>
                    </DataTemplate>
                </dx:DXCollectionView.ItemTemplate>
            </dx:DXCollectionView>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>